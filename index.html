<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SKF 5S • CH 24 Rettifica</title>
  <link rel="icon" href="assets/skf-192.png" />
  <link rel="stylesheet" href="style.v1k.css">
</head>
<body>
  <header class="topbar">
    <div class="brand"><img src="assets/skf-192.png" alt="SKF"><span>SKF 5S</span></div>
    <div class="tools">
      <a class="btn ghost" href="checklist.html">Vai alla checklist →</a>
    </div>
  </header>

  <main class="container narrow">
    <section class="card hero-card">
      <img src="assets/5s-hero.png" alt="5S hero">
      <div>
        <h1>CH 24 — Rettifica</h1>
        <div class="cta">
          <a class="btn primary" href="checklist.html">Vai alla checklist</a>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Cosa è 5S</h2>
      <ul class="bullets">
        <li><span class="pill s1">1S Selezionare</span> — Eliminare il superfluo.</li>
        <li><span class="pill s2">2S Sistemare</span> — Un posto per tutto.</li>
        <li><span class="pill s3">3S Splendere</span> — Pulire e prevenire lo sporco.</li>
        <li><span class="pill s4">4S Standardizzare</span> — Regole e segnali chiari.</li>
        <li><span class="pill s5">5S Sostenere</span> — Abitudine e miglioramento continuo.</li>
      </ul>
    </section>

    <section class="card">
      <h2>Andamento CH 24</h2>
      <canvas id="introChart" height="140"></canvas>
    </section>
  </main>

  <div class="build-badge">BUILD v1k-CH24</div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script>
  (function(){
    const KEY='skf.5s.v1k';
    function load(){try{const v=localStorage.getItem(KEY);if(v){const s=JSON.parse(v);if(s&&Array.isArray(s.areas))return s}}catch(e){}return{areas:[]}}
    function kpi(area){
      if(!area) return {score:0,late:0};
      const Ss=['1S','2S','3S','4S','5S']; let sum=0,tot=0,late=0,now=Date.now();
      Ss.forEach(S=>(((area.sectors||{}).Rettifica||{})[S]||[]).forEach(it=>{
        const v=Math.max(0,Math.min(5,parseInt(it.val||0,10)||0)); sum+=v; tot+=5;
        const t=it.due?Date.parse(it.due):NaN; if(!isNaN(t)&&t<now&&v<5) late++;
      }));
      return {score:tot?Math.round((sum/tot)*100):0,late};
    }
    const st=load(); const a=st.areas[0]; const {score,late}=kpi(a);
    const ctx=document.getElementById('introChart').getContext('2d');
    new Chart(ctx,{
      type:'bar',
      data:{labels:['Punteggio medio','Azioni in ritardo'],datasets:[{data:[score,late]}]},
      options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,max:100,grid:{display:false}},x:{grid:{display:false}}}}
    });
  })();
  </script>
</body>
</html>
